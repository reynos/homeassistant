### house_mode.yaml automation

## Automated Select Scenes - House modes Evening, Night and Day (Bedtime and Holiday only called manually)

- alias: Set Evening mode at Sunset
  trigger:
    platform: sun
    event: sunset     # Possible values: sunset, sunrise
#    platform: numeric_state
#    entity_id: sun.sun
#    value_template: "{{ state.attributes.elevation }}"
    # Can be a positive or negative number
#    below: 0.5
  action:
    - service: logbook.log
      data_template:
        name: 'Sunset:'
        message: 'Evening lights ON'
    - service: script.turn_on
      data_template:
        entity_id: >
          {% if states.input_select.house_mode.state == 'Holiday' %}
            script.evening_holiday
          {% else %}
            script.evening
          {% endif %}

## below needs to cater for holiday mode! maybe for simplicity just mrege back with the one above
- alias: Set Inside Lights at Dusk
  trigger:
    platform: numeric_state
    entity_id: sensor.light_sensor_61 # this updates fom the Z-wave sensor every 5mins?
    below: 200
  action:
    - service: logbook.log
      data_template:
        name: 'Dusk:'
        message: 'Inside lights ON'
    - service: light.turn_on
      entity_id:
        - light.kitchen_bench_7
        - light.lounge_lamp_3
        - light.stairs_16
# if either in study turn on study lamp
    - service_template: >
        {% if states.device_tracker.reynolds_darren.state == 'study' %}
          light.turn_on
        {% elif states.device_tracker.reynolds_blythe.state == 'study' %}
          light.turn_on
        {% endif %}
      entity_id: light.study_lamp_18

- alias: Auto Set Night mode
  trigger:
    platform: time
    at: '22:30:00'
  action:
    service: script.turn_on
    data_template:
      entity_id: >
        {% if states.input_select.house_mode.state == 'Holiday' %}
          script.night_holiday
        {% else %}
          script.night
        {% endif %}

- alias: Set Day mode
  trigger:
    platform: time
    at: '05:30:00'
  action:
    service: script.turn_on
    data_template:
      entity_id: >
        {% if states.input_select.house_mode.state == 'Holiday' %}
          script.day_holiday
        {% else %}
          script.day
        {% endif %}
#    service: input_select.select_option
#    data:
#      entity_id: input_select.house_mode
#      option: 'Day'

- alias: "House Mode Bedtime"
  trigger:
    platform: state
    entity_id: input_select.house_mode
    to: 'Bedtime'
############
  condition:
    condition: state
    entity_id: input_boolean.bedtime_beacon_flag
    state: 'off'
  action:
    service: script.turn_on
    data:
      entity_id: script.bedtime

- alias: "House Mode Evening"
  trigger:
    platform: state
    entity_id: input_select.house_mode
    to: 'Evening'
  action:
    - service: frontend.set_theme
      data:
        name: night
    - service: scene.turn_on
      entity_id: scene.evening

- alias: "House Mode Day"
  trigger:
    platform: state
    entity_id: input_select.house_mode
    to: 'Day'
  action:
    service: script.turn_on
    entity_id: script.day

- alias: "House Mode Night"
  trigger:
    platform: state
    entity_id: input_select.house_mode
    to: 'Night'
  action:
    - service: script.turn_on
      entity_id: script.night

- alias: "House Mode Holiday"
  trigger:
    platform: state
    entity_id: input_select.house_mode
    to: 'Holiday'
  action:
    - service: notify.ios_Darren
      data:
        message: "Holiday mode set"
        data:
          push:
            badge: 5
          subtitle: "Mode"

- alias: "House Mode Holiday Off"
  trigger:
    platform: state
    entity_id: input_select.house_mode
    from: 'Holiday'
  action:
    - service: notify.ios_Darren
      data:
        message: "Holiday mode OFF"
        data:
          push:
            badge: 5
          subtitle: "Mode"
    - service: input_boolean.turn_off
      entity_id: input_boolean.evening_holiday

- alias: "House Mode SydneyFC"
  trigger:
    platform: state
    entity_id: input_select.house_mode
    to: 'Sydney FC Game'
  action:
    service: scene.turn_on
    entity_id: scene.sydneyfc
