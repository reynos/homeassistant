### doorbell.yaml
doorbell:
  alias: Ring Doorbell
  sequence:
    - service: media_player.sonos_snapshot
      data:
        entity_id:
          - media_player.kitchen
          - media_player.master_bedroom
          - media_player.study
    - service: media_player.sonos_join
      data:
        master: media_player.study
        entity_id:
          - media_player.kitchen
          - media_player.master_bedroom
          - media_player.study
    - service: media_player.play_media
      data:
        entity_id: media_player.study # the group master
        media_content_id: http://10.0.26.20/sounds/doorbell.mp3
#        media_content_id: http://10.0.26.20/sounds/silence.mp3  #silence for testing
        media_content_type: music
    - service: media_player.volume_set
      data:
        entity_id:
          - media_player.kitchen
          - media_player.master_bedroom
          - media_player.study
        volume_level: 0.50
    - delay:
        seconds: 4
    - service: media_player.sonos_unjoin
      data:
        entity_id:
          - media_player.kitchen
          - media_player.master_bedroom
          - media_player.study
    - service: media_player.sonos_restore
      data:
        entity_id:
          - media_player.kitchen
          - media_player.master_bedroom
          - media_player.study
    - service: logbook.log
      data_template:
        name: Doorbell (day)
        message: has rung

doorbell_night:
  alias: Ring Doorbell in Master Bedroom
  sequence:
    - service: media_player.sonos_snapshot
      data:
        entity_id: media_player.master_bedroom
    - service: media_player.volume_set
      data:
        entity_id: media_player.master_bedroom
        volume_level: 0.40
    - service: media_player.play_media
      data:
        entity_id: media_player.master_bedroom
        media_content_id: http://10.0.26.20/sounds/doorbell.mp3
        media_content_type: music
    - delay:
        seconds: 4
    - service: media_player.sonos_restore
      data:
        entity_id: media_player.master_bedroom
    - service: logbook.log
      data_template:
        name: Doorbell (night)
        message: has rung

doorbell_lights_off:
  alias: Turn off lights after Doorbell
  sequence:
    service: script.turn_on
    data_template:
      entity_id: >
        {% if states.input_select.house_mode.state == 'Evening' %}
          script.doorbell_lights_off_evening
        {% elif states.input_boolean.evening_holiday.state == 'on' %}
          script.doorbell_lights_off_evening
        {% elif states.input_select.house_mode.state == 'Bedtime' %}
          script.doorbell_lights_off_evening
        {% elif states.input_select.house_mode.state == 'Night' %}
          script.doorbell_lights_off_night
        {% elif states.input_select.house_mode.state == 'Holiday' %}
          script.doorbell_lights_off_night
        {% endif %}
doorbell_lights_off_evening:
  sequence:
    - service: logbook.log
      data_template:
        name: Doorbell Evening lights
        message: turned OFF
    - service: light.turn_off
      entity_id: light.front_porch_21
doorbell_lights_off_night:
  sequence:
    - service: logbook.log
      data_template:
        name: Doorbell Night lights
        message: turned OFF
    - service: light.turn_off
      entity_id:
        - light.front_porch_21
        - light.front_garden_28

## only required to simulate the action the doorbell being pushed - via input_boolean.sonos_goup_test
sonos_group_test:
  alias: Sonos Group test
  sequence:
    - service: media_player.sonos_snapshot
      data:
        entity_id:
          - media_player.kitchen
          - media_player.master_bedroom
          - media_player.study
    - service: media_player.sonos_join
      data:
        master: media_player.study
        entity_id:
          - media_player.kitchen
          - media_player.master_bedroom
          - media_player.study
    - service: media_player.play_media
      data:
        entity_id: media_player.study # the group master
        media_content_id: http://10.0.26.20/sounds/doorbell.mp3
        media_content_type: music
    - service: media_player.volume_set
      data:
        entity_id:
          - media_player.study
          - media_player.kitchen
          - media_player.master_bedrom
        volume_level: 0.50
    - delay:
        seconds: 4
    - service: media_player.sonos_unjoin
      data:
        entity_id:
          - media_player.kitchen
          - media_player.master_bedroom
          - media_player.study
    - service: media_player.sonos_restore
      data:
        entity_id:
          - media_player.kitchen
          - media_player.master_bedroom
          - media_player.study
